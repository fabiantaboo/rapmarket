<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RapMarket.de - Frontend Debug</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container mt-5">
        <h1><i class="fas fa-microphone me-2"></i>RapMarket.de - Debug</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Registrierung testen</h5>
                    </div>
                    <div class="card-body">
                        <form id="debugRegisterForm">
                            <div class="mb-3">
                                <label>Username:</label>
                                <input type="text" class="form-control" id="debug_reg_username" value="testuser123">
                            </div>
                            <div class="mb-3">
                                <label>E-Mail:</label>
                                <input type="email" class="form-control" id="debug_reg_email" value="test@example.com">
                            </div>
                            <div class="mb-3">
                                <label>Passwort:</label>
                                <input type="password" class="form-control" id="debug_reg_password" value="test123">
                            </div>
                            <div class="mb-3">
                                <label>Passwort best√§tigen:</label>
                                <input type="password" class="form-control" id="debug_reg_confirm" value="test123">
                            </div>
                            <button type="button" class="btn btn-primary" onclick="testRegister()">
                                Registrierung testen
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Login testen</h5>
                    </div>
                    <div class="card-body">
                        <form id="debugLoginForm">
                            <div class="mb-3">
                                <label>Username:</label>
                                <input type="text" class="form-control" id="debug_login_username" value="admin">
                            </div>
                            <div class="mb-3">
                                <label>Passwort:</label>
                                <input type="password" class="form-control" id="debug_login_password" value="">
                            </div>
                            <button type="button" class="btn btn-success" onclick="testLogin()">
                                Login testen
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>API Tests</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-info me-2" onclick="testDebugAPI()">Debug API Info</button>
                        <button class="btn btn-warning me-2" onclick="testSessionCheck()">Session Check</button>
                        <button class="btn btn-secondary me-2" onclick="testV2API()">V2 API Test</button>
                        <button class="btn btn-danger" onclick="clearResults()">Clear Results</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Ergebnisse</h5>
                    </div>
                    <div class="card-body">
                        <pre id="results" style="background: #f8f9fa; padding: 15px; min-height: 200px; overflow-x: auto;"></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function log(message, data = null) {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            let output = `[${timestamp}] ${message}`;
            
            if (data) {
                output += '\n' + JSON.stringify(data, null, 2);
            }
            
            results.textContent += output + '\n\n';
            results.scrollTop = results.scrollHeight;
        }
        
        function clearResults() {
            document.getElementById('results').textContent = '';
        }
        
        async function apiRequest(endpoint, data) {
            try {
                log(`API Request zu: ${endpoint}`, data);
                
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify(data)
                });
                
                log(`Response Status: ${response.status} ${response.statusText}`);
                
                const responseText = await response.text();
                log(`Raw Response:`, responseText);
                
                try {
                    const jsonData = JSON.parse(responseText);
                    log(`Parsed JSON:`, jsonData);
                    return jsonData;
                } catch (e) {
                    log(`JSON Parse Error:`, e.message);
                    throw new Error('Invalid JSON response: ' + responseText.substring(0, 100));
                }
                
            } catch (error) {
                log(`API Error:`, error.message);
                throw error;
            }
        }
        
        async function testRegister() {
            const data = {
                action: 'register',
                username: document.getElementById('debug_reg_username').value,
                email: document.getElementById('debug_reg_email').value,
                password: document.getElementById('debug_reg_password').value,
                confirm_password: document.getElementById('debug_reg_confirm').value
            };
            
            try {
                const result = await apiRequest('api/auth_debug.php', data);
                log('Registrierung Ergebnis:', result);
            } catch (error) {
                log('Registrierung Fehler:', error.message);
            }
        }
        
        async function testLogin() {
            const data = {
                action: 'login',
                username: document.getElementById('debug_login_username').value,
                password: document.getElementById('debug_login_password').value
            };
            
            try {
                const result = await apiRequest('api/auth_debug.php', data);
                log('Login Ergebnis:', result);
            } catch (error) {
                log('Login Fehler:', error.message);
            }
        }
        
        async function testDebugAPI() {
            try {
                const response = await fetch('api/auth_debug.php');
                const text = await response.text();
                const data = JSON.parse(text);
                log('Debug API Info:', data);
            } catch (error) {
                log('Debug API Fehler:', error.message);
            }
        }
        
        async function testSessionCheck() {
            try {
                const result = await apiRequest('api/auth_debug.php', {action: 'check_session'});
                log('Session Check:', result);
            } catch (error) {
                log('Session Check Fehler:', error.message);
            }
        }
        
        async function testV2API() {
            try {
                const result = await apiRequest('api/auth_v2.php', {
                    action: 'check_session'
                });
                log('V2 API Test:', result);
            } catch (error) {
                log('V2 API Fehler:', error.message);
            }
        }
        
        // Auto-load debug info
        document.addEventListener('DOMContentLoaded', function() {
            log('=== RapMarket Debug Frontend geladen ===');
            testDebugAPI();
        });
    </script>
</body>
</html>